# 製品構成デザインツール

自動車などの製品の部品構成を木構造で表現し、制約評価・価格計算・リスク評価を行うインタラクティブなデモアプリケーションです。

## 背景

自動車などの機器の構成を初期検討する際、様々なバリエーションの部品構成があり、それぞれに制約、価格、リスクが異なります。このツールは過去の事例や構成情報、トラブルメモを活用しながら、最適な製品設計を検討するための支援ツールです。

## 主な機能

### 1. 木構造による製品構成の可視化
- 製品の構成要素を階層的な木構造で表現
- 各選択ポイント（接点）で部品を選択
- リアルタイムで構成を組み立て

### 2. 制約評価（Z3 Solver WASM使用）
- **Z3 Solver**を使った高度な制約充足問題の解決
- 部品間の互換性チェック
- 技術的な制約の検証
- エラー、警告、情報の3段階で制約違反を表示
- 論理式による制約定義（AND, OR, NOT, IMPLIES等）

### 3. 価格計算
- 選択した部品の合計価格を自動計算
- 部品ごとの価格内訳を表示
- 価格情報が不足している部品の警告

### 4. リスク評価
- 過去事例に基づくリスクスコアの算出
- 成功事例、問題事例、警告の表示
- 関連する過去事例の参照

## UI構成

### 左ペイン：部品構成ツリー
- 階層的な木構造で製品構成を表示
- 各選択ポイントでドロップダウンから部品を選択
- 選択した部品の詳細情報（説明、価格）を表示

### 右ペイン上部：制約と過去事例
- **制約一覧**：すべての制約ルールを表示
  - エラー（赤）：組み合わせ不可
  - 警告（黄）：推奨されない
  - 情報（青）：推奨される組み合わせ
- **過去事例**：関連する成功事例、問題事例、警告を表示

### 右ペイン下部：評価実行と結果
- **制約評価ボタン**：現在の構成を評価
- **評価結果表示**：
  - 合計価格と内訳
  - リスクスコア（1-10段階）
  - 制約違反の一覧
  - 警告メッセージ

## 技術スタック

- **React 19** - UIフレームワーク
- **TypeScript** - 型安全な開発
- **Vite** - 高速ビルドツール
- **TailwindCSS** - ユーティリティファーストCSS
- **Z3 Solver (WASM)** - Microsoft製の定理証明器/制約ソルバー
  - `z3-solver` パッケージを使用
  - WebAssembly版で軽量に動作
  - 制約充足問題（CSP）の解決に使用
- **React Flow** - フローチャート・グラフ可視化（依存関係のみ）

## セットアップ

### 必要な環境
- Node.js 18以上
- npm または yarn

### インストール

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# プロダクションビルド
npm run build

# プレビュー
npm run preview
```

## サンプルデータ

自動車の部品構成を例として以下のデータを用意しています：

### 部品カテゴリ
- **エンジン**: ガソリン1.5L, ガソリン2.0L, ディーゼル2.0L, ハイブリッド
- **トランスミッション**: 5速MT, 6速AT, CVT
- **タイヤ**: 16インチ標準, 17インチスポーツ, 18インチプレミアム
- **ブレーキ**: 標準ディスク, 大径ベンチレーテッド, カーボンセラミック
- **サスペンション**: 標準, スポーツ
- **インテリア**: ファブリック, レザー, スポーツシート

### 制約例
- ハイブリッド × 5速MT：組み合わせ不可（技術的制約）
- ディーゼル × CVT：組み合わせ不可（技術的制約）
- 1.5Lエンジン × 18インチタイヤ：非推奨（性能低下）
- スポーツタイヤ × 高性能ブレーキ：推奨

### 過去事例
- 1.5L + CVT：多数の成功実績（リスクスコア: 1）
- 2.0L + スポーツタイヤ：振動問題の報告（リスクスコア: 6）
- ハイブリッド + CVT：高評価（リスクスコア: 2）

## プロジェクト構造

```
ccw-feature_explore/
├── src/
│   ├── components/          # Reactコンポーネント
│   │   ├── TreeView.tsx        # 木構造表示
│   │   ├── ConstraintsPanel.tsx # 制約・過去事例表示
│   │   └── EvaluationPanel.tsx  # 評価実行・結果表示
│   ├── types/               # TypeScript型定義
│   │   └── index.ts
│   ├── data/                # サンプルデータ
│   │   └── sampleData.ts
│   ├── utils/               # ユーティリティ関数
│   │   └── evaluation.ts    # 評価ロジック
│   ├── App.tsx              # メインアプリケーション
│   ├── main.tsx             # エントリーポイント
│   └── index.css            # グローバルスタイル
├── index.html
├── vite.config.ts
├── tsconfig.json
├── tailwind.config.js
└── package.json
```

## 使い方

1. **部品を選択**：左ペインの各選択ポイントでドロップダウンから部品を選択
2. **制約を確認**：右ペイン上部で適用される制約と過去事例を確認
3. **評価を実行**：右ペイン下部の「制約評価を実行」ボタンをクリック
4. **結果を確認**：
   - 合計価格と内訳
   - リスクスコア
   - 制約違反の有無
   - 警告メッセージ

## Z3 Solverによる制約評価

このアプリケーションは、Microsoft Researchが開発した高性能な定理証明器「Z3」のWebAssembly版を使用して、制約評価を行っています。

### Z3制約の定義方法

制約は以下のような論理式で定義できます：

```typescript
{
  id: 'const-1',
  name: 'ハイブリッド×マニュアル非対応',
  description: 'ハイブリッドシステムは5速マニュアルと組み合わせできません',
  componentIds: ['eng-4', 'trans-1'],
  z3Constraint: {
    expr: 'not',  // NOT (eng-4 AND trans-1)
    components: ['eng-4', 'trans-1'],
  },
  severity: 'error',
}
```

### サポートする論理式

- `and` - 論理積（すべて真）
- `or` - 論理和（いずれか真）
- `not` - 論理否定（両方同時に真でない）
- `implies` - 含意（A ならば B）
- `xor` - 排他的論理和（どちらか一方のみ真）

### Z3の利点

1. **高速な制約評価**：複雑な論理式も効率的に解決
2. **形式的な検証**：数学的に厳密な制約チェック
3. **スケーラビリティ**：大規模な制約セットにも対応可能
4. **軽量実装**：WASM版で追加の約135KBのみ

### フォールバック機構

Z3の初期化や評価でエラーが発生した場合、自動的に従来のJavaScript関数ベースの評価にフォールバックします。

## 今後の拡張可能性

- ✅ **Z3 Solverによる高度な制約評価**（実装済み）
- 次に選択すべき部品のナビゲーション機能（Z3の最適化機能を活用）
- 最適な構成の自動提案（Z3による最適化問題の解決）
- 構成の保存・読み込み機能
- 複数構成の比較機能
- SHACL（RDF制約）のサポート
- グラフィカルな可視化の強化（React Flowの活用）
- より複雑な制約（数値制約、順序制約など）のサポート

## ライセンス

ISC
